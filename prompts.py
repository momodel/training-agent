"""提示词管理模块"""
from typing import Dict, Any, List
import json

def get_analysis_prompt(dataset_preview: str) -> str:
    """生成数据集分析的提示词"""
    return f"""
    请分析这个数据集，并以 JSON 格式返回以下信息：
    1. data_type: 数据集类型（表格/图像/文本）
    2. task_type: 可能的任务类型（分类/回归/聚类等）
    3. features: 特征说明
    4. target: 目标变量
    5. preprocessing_steps: 建议的预处理步骤
    
    数据集预览：
    {dataset_preview}
    """

def get_theory_prompt(knowledge_points: List[str], dataset_info: Dict[str, Any]) -> str:
    """获取理论内容生成的提示"""
    return f"""作为一个 AI 培训内容生成专家，请基于以下知识点和数据集信息生成一个高质量的 Jupyter notebook 教程。

数据集信息: {json.dumps(dataset_info, ensure_ascii=False)}
知识点: {', '.join(knowledge_points)}

请严格按照以下结构生成教程内容：

# 机器学习实训课程

# [具体算法/方法名称]教程

## 任务定义与目标
- 明确任务类型（分类/回归/聚类等）
- 任务难点和挑战
- 评估指标的选择和解释
- 预期目标和实际应用价值

## 数据集介绍与加载
### 数据集说明
- 数据集的基本信息（来源、规模、特点）
- 字段说明和数据类型
- 数据质量评估（完整性、一致性、准确性）
- 数据集在实际场景中的应用价值

### 数据加载与初步查看
- 实现数据加载代码
- 展示数据基本信息（info、head等）
- 初步统计信息（describe）

## 数据探索与分析
### 数据分布分析
- 数值特征的统计特性及可视化
- 类别特征的分布情况及可视化
- 目标变量的分布分析及可视化

### 特征相关性分析
- 特征间的相关性分析与热力图
- 特征与目标变量的关系分析
- 特征重要性分析与可视化

### 数据质量分析
- 缺失值检测与处理
- 异常值检测与处理
- 数据清洗代码实现

## 特征工程与预处理
### 理论讲解
- 特征工程的重要性
- 常用的特征工程方法
- 针对当前数据集的特征工程策略

### 代码实现
- 特征选择和转换
- 特征编码（类别特征处理）
- 特征缩放（标准化/归一化）
- 特征组合与创建

## 模型构建与训练
### 算法原理
- 介绍算法的起源和发展历史
- 核心概念和基本原理（使用LaTeX公式）
- 算法的工作流程和步骤
- 重要参数的含义和影响

### 模型实现
- 模型初始化和参数设置
- 数据集划分代码
- 模型训练过程
- 参数调优实现

## 模型评估与优化
### 评估指标
- 不同评估指标的原理
- 评估指标的选择依据
- 评估代码实现

### 模型优化
- 交叉验证实现
- 网格搜索/随机搜索代码
- 模型集成方法实现
- 结果可视化与分析

## 模型应用与部署
### 预测与应用
- 模型预测代码实现
- 预测结果分析
- 模型应用示例

### 结果可视化
- 预测结果可视化
- 模型性能图表
- 特征重要性展示

## 实践练习与拓展
设计3-5个由浅入深的练习题，每个练习都包含：
- 明确的问题描述
- 详细的解题思路
- 完整的参考代码
- 结果分析和讨论

注意事项：
1. 每个部分的代码都必须是完整且可直接运行的
2. 代码块必须使用 ```python 和 ``` 标记
3. 每个代码块前必须有清晰的说明文本
4. 代码中要包含必要的注释
5. 确保代码的可复现性
6. 使用 LaTeX 格式书写数学公式
7. 重要概念使用加粗标记
8. 适当使用列表和表格组织内容

特别强调：
- 理论与代码的紧密结合
- 每个步骤都要有实践支撑
- 代码的可执行性和完整性
- 结果的可视化和解释
- 内容的专业性和准确性
- 示例的实用性和教学价值
- 练习的递进性和完整性

请生成内容丰富、结构清晰、理论与实践紧密结合的教程。确保每个概念都有相应的代码实现，每个步骤都有实践支撑。"""

def get_code_prompt(dataset_info: Dict[str, Any]) -> str:
    """获取代码示例生成的提示"""
    return f"""基于以下数据集信息生成一系列完整的、可执行的代码示例：
数据集信息: {json.dumps(dataset_info, ensure_ascii=False)}

请生成以下几个部分的代码：

1. 数据加载和预处理：
```python
# 导入所需的库
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
# 设置中文显示
plt.rcParams['font.sans-serif'] = ['SimHei']
plt.rcParams['axes.unicode_minus'] = False

# TODO: 加载数据集
# 你需要实现数据加载的代码
data = ...

# 数据基本信息
print("数据集信息：")
print(data.info())
```

2. 数据探索和可视化：
- 使用 describe() 查看基本统计信息
- 使用 matplotlib 和 seaborn 创建可视化图表
- 添加详细的注释说明每个步骤

3. 特征工程：
- 数据清洗和预处理的代码
- 特征选择和转换
- 使用 sklearn 的相关功能

4. 模型构建：
- 模型初始化和参数设置
- 训练过程
- 模型评估

要求：
1. 代码结构：
   - 每个代码块都要有清晰的注释
   - 使用 TODO 标记需要学习者完成的部分
   - 提供完整的代码和简化版本

2. 代码质量：
   - 遵循 PEP 8 规范
   - 使用有意义的变量名
   - 包含错误处理
   - 代码要简洁且易于理解

3. 可视化：
   - 使用适当的图表类型
   - 添加图表标题和标签
   - 确保图表美观且信息丰富

4. 交互性：
   - 添加可以调整的参数
   - 提供不同的可视化选项
   - 包含实验性的代码块

请确保生成的代码是完整的、可以直接运行的，并且包含充分的注释和说明。"""

def get_exercises_prompt(difficulty_level: str, dataset_info: Dict[str, Any]) -> str:
    """获取练习题生成的提示"""
    return f"""基于以下数据集信息生成一系列具有教学价值的练习题：
数据集信息: {json.dumps(dataset_info, ensure_ascii=False)}
难度级别: {difficulty_level}

请生成 3-5 个练习题，每个练习题都应该包含以下部分：

## 练习 1
### 问题
[详细的问题描述]

### 提示
- 提示 1: ...
- 提示 2: ...
- 提示 3: ...

### 参考答案
[详细的解答过程和说明]

要求：
1. 练习题类型：
   - 编程实现题：需要编写代码解决的问题
   - 思考分析题：需要理论分析的问题
   - 实验探索题：需要调整参数观察结果的问题

2. 难度分布：
   - 基础题：基本概念和方法的应用
   - 进阶题：多个知识点的综合运用
   - 挑战题：需要创新思维的开放性问题

3. 问题设计：
   - 明确的目标和要求
   - 循序渐进的思考过程
   - 结合实际场景的应用
   - 包含必要的数据和条件

4. 提示设计：
   - 分步骤的引导
   - 关键知识点的提醒
   - 可能遇到的问题预警
   - 不直接给出答案

5. 参考答案：
   - 详细的解题思路
   - 完整的代码实现
   - 结果分析和讨论
   - 扩展思考和优化建议

每个练习题都应该：
1. 紧密结合数据集特征
2. 覆盖不同的知识点
3. 包含实际应用场景
4. 有明确的教学目标
5. 提供充分的解释和讨论

请按照这个格式生成练习题，确保每个练习题都是完整的、有教学价值的，并且难度符合要求。"""

def get_content_organization_prompt(content: Dict[str, Any]) -> str:
    """获取内容组织的提示"""
    return f"""
    请将以下内容组织成一个结构化的实训教程。每个代码示例必须放在单独的代码块中，不要将代码放在文本说明中。

    理论内容：
    {content.get('theory', '')}

    代码示例：
    {content.get('code_examples', '')}

    练习题：
    {content.get('exercises', '')}

    要求：
    1. 内容组织：
       - 背景介绍（纯文本）
       - 理论讲解（纯文本）
       - 代码示例（每个示例都要放在单独的代码块中）
       - 实践练习（问题描述用文本，示例代码放在代码块中）

    2. 格式要求：
       - 所有代码必须放在单独的代码块中，使用 ```python 和 ``` 标记
       - 代码块前后必须有说明文本
       - 不要在文本说明中包含代码
       - 每个代码块都应该是完整且可执行的

    3. 代码块规范：
       - 每个代码块都必须以 ```python 开始，以 ``` 结束
       - 代码块中不要包含 Markdown 标记
       - 代码块中的代码要有适当的缩进
       - 每个代码块都要有完整的导入语句

    4. 文本说明规范：
       - 使用 Markdown 标题标记（#）组织层级
       - 每个代码块前要有清晰的说明
       - 理论部分要分段解释
       - 练习题要有明确的要求和提示

    请确保严格遵循以上格式要求，特别是代码块的处理。
    """ 